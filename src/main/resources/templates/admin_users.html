<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title>관리자 페이지 - 사용자 관리</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f7f8fa; margin:0; padding:0; color:#333; }
    header { background: #3b82f6; color: white; padding: 1rem 2rem; display:flex; justify-content: space-between; align-items:center; }
    main { padding:2rem; }
    table { width:100%; border-collapse: collapse; margin-top:1rem; background:white; border-radius:8px; overflow:hidden; }
    th, td { padding:0.8rem 1rem; text-align:left; border-bottom:1px solid #ddd; }
    th { background:#e0e7ff; }
    /* 입력 필드가 셀 너비를 차지하도록 설정 */
    input[type="text"], input[type="password"], select {
      width: 100%;
      padding: 0.4rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .btn { padding:0.4rem 0.8rem; border:none; border-radius:4px; cursor:pointer; }
    .btn-save { background:#3b82f6; color:white; }
    .btn-delete { background:#ef4444; color:white; }
    .btn:hover { opacity:0.9; }
    /* 폼 구조를 테이블 셀에 맞게 조정 */
    /* display:contents는 폼이 td 구조를 깨지 않도록 하지만,
       브라우저 호환성 문제나 레이아웃 문제를 일으킬 수 있어
       여기서는 인라인 폼 스타일을 유지하고 div만 수정했습니다. */
    .action-cell { display:flex; gap:0.5rem; }
  </style>
</head>
<body>
<header>
  <h1>관리자 페이지 - 사용자 관리</h1>
  <nav>
    <a th:href="@{/main}" style="color:white; text-decoration:none; margin-right: 15px;">메인</a>
    <a th:href="@{/admin/teams}" style="color:white; text-decoration:none;">팀 관리</a>
  </nav>
</header>
<main>
  <table>
    <thead>
    <tr>
      <th>이름</th>
      <th>사용자명</th>
      <th>새 비밀번호</th>
      <th>역할</th>
      <th style="width: 150px;">작업</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="user : ${users}">
      <form th:action="@{/admin/users/update}" method="post">

        <input type="hidden" th:name="userId" th:value="${user.id}" />

        <td>
          <input type="text" th:name="name" th:value="${user.name}" required />
        </td>

        <td>
          <input type="text" th:name="username" th:value="${user.username}" required />
        </td>

        <td>
          <input type="password" th:name="password" placeholder="새 비밀번호 입력 (생략 가능)" />
        </td>

        <td>
          <select th:name="role">
            <option th:value="ROLE_USER" th:selected="${user.role.name() == 'ROLE_USER'}">USER</option>
            <option th:value="ROLE_ADMIN" th:selected="${user.role.name() == 'ROLE_ADMIN'}">ADMIN</option>
          </select>
        </td>

        <td>
          <div class="action-cell">
            <button type="submit" class="btn btn-save">💾 저장</button>
      </form>
      <form th:action="@{/admin/users/delete}" method="post">
        <input type="hidden" th:name="userId" th:value="${user.id}" />
        <button type="submit" class="btn btn-delete" onclick="return confirm('정말 삭제하시겠습니까? 해당 사용자의 팀장 정보 및 제출 기록이 영향을 받을 수 있습니다.');">🗑 삭제</button>
      </form>
      </div>
      </td>
    </tr>
    </tbody>
  </table>
</main>
</body>
</html>